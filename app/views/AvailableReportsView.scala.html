@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.availableReports._
@import utils.ReportHelpers

@this(
        layout: templates.Layout,
        govukButton: GovukButton,
        govukTabs: GovukTabs,
        govukTable: GovukTable

)

@(availableReports: AvailableReportsViewModel,
maybeUserReports: Boolean,
maybeThirdPartyReports: Boolean,
guidanceUrl: String
)(implicit request: Request[_], messages: Messages)

@userReportsContent = {
  <div class="tre-table-container" tabindex="0" role="region" aria-label="@messages("availableReports.myReports")" aria-describedby="available-user-reports-scroll-hint">
    <div id="available-user-reports-scroll-hint" class="govuk-visually-hidden">@messages("availableReports.scrollHint")</div>
    @govukTable(Table(
      head = Some(Seq(
        HeadCell(content = Text(messages("availableReports.table.reportName"))),
        HeadCell(content = Text(messages("availableReports.table.referenceNumber"))),
        HeadCell(content = Text(messages("availableReports.table.reportType"))),
        HeadCell(content = Text(messages("availableReports.table.expiryDate"))),
        HeadCell(content = Text(messages("availableReports.table.action")))
      )),
    rows = availableReports.availableUserReports.getOrElse(Seq.empty).map { data =>
      Seq(
        TableRow(content = Text(messages(data.reportName))),
        TableRow(content = Text(messages(data.referenceNumber))),
        TableRow(content = Text(messages(data.formattedReportType))),
        TableRow(content = Text(messages(data.formattedExpiryDate))),
        TableRow(
            content = HtmlContent(
                data.action.map { action =>
                    s"""<div>
                        |  <a href=${controllers.routes.AvailableReportsController.auditDownloadFile(action.fileURL,action.fileName,data.referenceNumber)} class="govuk-link">
                        |    ${action.fileName} (${action.fileType}, ${ReportHelpers.formatBytes(action.size)})
                        |  </a>
                        |</div>""".stripMargin
                    }.mkString
                )
            )
        )
    },
      caption = Some(messages("availableReports.myReports")),
      captionClasses = "govuk-table__caption--l"
    ))
  </div>
}

@thirdPartyReportsContent = {
  <div class="tre-table-container" tabindex="0" role="region" aria-label="@messages("availableReports.thirdPartyReports")" aria-describedby="available-third-party-reports-scroll-hint">
    <div id="available-third-party-reports-scroll-hint" class="govuk-visually-hidden">@messages("availableReports.thirdPartyReports")</div>
    @govukTable(Table(
      head = Some(Seq(
        HeadCell(content = Text(messages("availableReports.table.reportName"))),
        HeadCell(content = Text(messages("availableReports.table.referenceNumber"))),
        HeadCell(content = Text(messages("availableReports.table.businessInfo"))),
        HeadCell(content = Text(messages("availableReports.table.reportType"))),
        HeadCell(content = Text(messages("availableReports.table.expiryDate"))),
        HeadCell(content = Text(messages("availableReports.table.action")))
      )),
    rows = availableReports.availableThirdPartyReports.getOrElse(Seq.empty).map { data =>
      Seq(
        TableRow(content = Text(messages(data.reportName))),
        TableRow(content = Text(messages(data.referenceNumber))),
        TableRow(content = Text(if (data.companyName == "Unknown") messages("availableReports.table.unknownCompany") else messages(data.companyName))),
        TableRow(content = Text(messages(data.formattedReportType))),
        TableRow(content = Text(messages(data.formattedExpiryDate))),
        TableRow(
            content = HtmlContent(
                data.action.map { action =>
                    s"""<div>
                        |  <a href="${action.fileURL}" class="govuk-link">
                        |    ${action.fileName} (${action.fileType}, ${ReportHelpers.formatBytes(action.size)})
                        |  </a>
                        |</div>""".stripMargin
                    }.mkString
                )
            )
        )
    },
        caption = Some(messages("availableReports.thirdPartyReports")),
        captionClasses = "govuk-table__caption--l"
        ))
    </div>
  }

@titleContent = @{
  if (maybeUserReports || maybeThirdPartyReports) {
   "availableReports.title"
  } else {
   "availableReports.title.none"
  }
}

    @layout(
    pageTitle = titleNoForm(messages(titleContent)),
    showBackLink = false,
    breadcrumbContribution = Seq(
    BreadcrumbsItem(content = Text(messages("availableReports.title")), href = Some(s"#"))),
    isFullWidth = true) {

   @if(maybeUserReports || maybeThirdPartyReports) {
       <h1 class="govuk-heading-xl">@messages("availableReports.heading")</h1>
       <p class="govuk-body">@messages("availableReports.message1")</p>
        <ul class="govuk-list--spaced govuk-list--bullet">
            <li class="govuk-body">@messages("availableReports.bullet1")</li>
            <li class="govuk-body">
                <a href="@guidanceUrl" class="govuk-link" rel="noreferrer noopener" target="_blank">@messages("availableReports.bullet2.link")</a>
                @messages("availableReports.bullet2")
            </li>
        </ul>
   } else {
       <h1 class="govuk-heading-xl">@messages("availableReports.heading.none")</h1>
        <p class="govuk-body">@messages("availableReports.message1.none")</p>
        <ul class="govuk-list--spaced govuk-list--bullet">
            <li class="govuk-body">
                <a href="@controllers.report.routes.RequestedReportsController.onPageLoad().url" class="govuk-link">@messages("availableReports.link1.none")</a>
            </li>
            <li class="govuk-body">
                <a href="@controllers.report.routes.ReportGuidanceController.onPageLoad().url" class="govuk-link">@messages("availableReports.link2.none")</a>
            </li>
        </ul>
       <p class="govuk-body">
        <a href="@routes.DashboardController.onPageLoad().url" class="govuk-link">@messages("availableReports.home.link")</a>
       </p>
   }


   @if(maybeUserReports && maybeThirdPartyReports) {
    @govukTabs(Tabs(
     items = Seq(
      TabItem(
       id = Some("my-reports"),
        label = "My reports",
        panel = TabPanel(
        content = HtmlContent(userReportsContent)
       )
      ),
      TabItem(
       id = Some("third-party-reports"),
       label = "Third party reports",
       panel = TabPanel(
       content = HtmlContent(thirdPartyReportsContent)
       )
      )
     )
    )
   )
   }

   @if(maybeUserReports && !maybeThirdPartyReports) {
    @userReportsContent
   }

   @if(!maybeUserReports && maybeThirdPartyReports) {
    @thirdPartyReportsContent
   }



}

