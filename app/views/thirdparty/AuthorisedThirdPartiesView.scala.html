@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import models.report._
@import utils.ReportHelpers
@import models.ReportStatus
@import models.thirdparty.AuthorisedThirdPartiesViewModel

@this(
  layout: templates.Layout,
  govukButton: GovukButton,
  govukTabs: GovukTabs,
  govukTable: GovukTable,
  govukTag: GovukTag,
)

@(authorisedThirdParties: Seq[AuthorisedThirdPartiesViewModel])(implicit request: Request[_], messages: Messages)

@mainContent = {
    @if(authorisedThirdParties.isEmpty) {
        @layout(pageTitle = messages("authorisedThirdParties.noThirdParties.title"), isFullWidth = true, breadcrumbContribution = Seq(
BreadcrumbsItem(content = Text(messages("authorisedThirdParties.noThirdParties.title")), href = Some(s"#"))
),
showBackLink = false) {
            <h1 class="govuk-heading-xl">@messages("authorisedThirdParties.noThirdParties.heading")</h1>
            <p class="govuk-body">
                @messages("authorisedThirdParties.noThirdParties.message1")
                <a href="@controllers.thirdparty.routes.AddThirdPartyController.onPageLoad().url"
                   class="govuk-link govuk-link--no-visited-state">
                    @messages("authorisedThirdParties.noThirdParties.link1")
                </a>
                @messages("authorisedThirdParties.noThirdParties.message2")
            </p>

            <p class="govuk-body">
                <a href="@controllers.routes.DashboardController.onPageLoad().url"
                       class="govuk-link govuk-link--no-visited-state">
                        @messages("authorisedThirdParties.noThirdParties.link2")
                </a>
            </p>
        }
    } else {
        @layout(pageTitle = titleNoForm(messages("authorisedThirdParties.title")), isFullWidth = true, breadcrumbContribution = Seq(
BreadcrumbsItem(content = Text(messages("authorisedThirdParties.title")), href = Some(s"#"))
),
showBackLink = false) {
            <h1 class="govuk-heading-xl">@messages("authorisedThirdParties.heading")</h1>
            <p class="govuk-body">@messages("authorisedThirdParties.message1")</p>
            <p class="govuk-body">
                @messages("authorisedThirdParties.message2")
                <a href="@controllers.thirdparty.routes.AddThirdPartyController.onPageLoad().url"
                   class="govuk-link govuk-link--no-visited-state">
                    @messages("authorisedThirdParties.link1")
                </a>.
            </p>
            @authorisedThirdPartiesContent
        }
    }
}

@authorisedThirdPartiesContent = {
    @govukTable(Table(
      head = Some(Seq(
        HeadCell(content = Text(messages("authorisedThirdParties.eori"))),
        HeadCell(content = Text(messages("authorisedThirdParties.businessInfo"))),
        HeadCell(content = Text(messages("authorisedThirdParties.referenceName"))),
        HeadCell(content = Text(messages("authorisedThirdParties.action")))
      )),
      rows = authorisedThirdParties.map { tp =>
        Seq(
          TableRow(content = Text(tp.eori)),
          TableRow(content = Text(tp.businessInfo.getOrElse(messages("authorisedThirdParties.businessInfo.notAvailable")))),
          TableRow(content = Text(tp.referenceName.getOrElse(messages("authorisedThirdParties.referenceName.notAvailable")))),
          TableRow(content = HtmlContent(
          s"""<span style="white-space: nowrap;">
                <a href="/request-customs-declaration-data/third-party-details-${tp.eori}">
                  ${messages("authorisedThirdParties.view")}
                  <span class="govuk-visually-hidden">${messages("authorisedThirdParties.view.hidden", tp.eori)}</span>
                </a> |
                <a href="/remove-third-party/${tp.eori}">
                  ${messages("authorisedThirdParties.remove")}
                  <span class="govuk-visually-hidden">${messages("authorisedThirdParties.remove.hidden", tp.eori)}</span>
                </a>
              </span>"""
           ))
        )
      }
    ))
}

@mainContent